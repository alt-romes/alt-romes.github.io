<!doctype html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Graphical Applications in Haskell with MVC and Gloss</title>
    
    <meta name="description" content="This is the first of two parts on creating interactive graphical applications with functional programming, in Haskell; this first part, using the <strong>Model-View-Controller</strong> pattern in its functional flavour through <code>gloss</code>. The <strong>MVC</strong> pattern is common accross all languages and goes by many names. For example, it's how smartphone applications are structured in Android Studio.">
    
    <link rel="stylesheet" href="../../css/default.css" />
    <link rel="stylesheet" href="../../css/clay.css" />
    <link rel="stylesheet" href="../../css/syntax.css" />

    <!-- open graph -->
    <meta property="og:title" content="Graphical Applications in Haskell with MVC and Gloss" />
    
    <meta property="og:description" content="This is the first of two parts on creating interactive graphical applications with functional programming, in Haskell; this first part, using the <strong>Model-View-Controller</strong> pattern in its functional flavour through <code>gloss</code>. The <strong>MVC</strong> pattern is common accross all languages and goes by many names. For example, it's how smartphone applications are structured in Android Studio." />
    

    
    
    

    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
    <link rel="manifest" href="../../site.webmanifest">

    <script defer data-domain="alt-romes.github.io" src="https://plausible.io/js/script.js"></script>
  </head>
  <body>
    <nav>
      <ul>
        <li class="logo"><a href="../../">romes</a></li>
        <li><a href="../../posts.html">blog</a></li>
        <li>music</li>
        <!-- <li><a href="/papers.html">publications</a></li> -->
        <li>publications</li>
        <li class="hidden-small"><a href="https://github.com/alt-romes" target="_blank">github</a></li>
        <li class="hidden-small"><a href="https://gitlab.haskell.org/alt-romes" target="_blank">ghc</a></li>
      </ul>
    </nav>
    <main>
      <header>
  <div class="title">
    <h1>Graphical Applications in Haskell with MVC and Gloss</h1>
    <p>
      
      Jun 27, 2022
      
    </p>
  </div>
  
  <p class="description">This is the first of two parts on creating interactive graphical applications with functional programming, in Haskell; this first part, using the <strong>Model-View-Controller</strong> pattern in its functional flavour through <code>gloss</code>. The <strong>MVC</strong> pattern is common accross all languages and goes by many names. For example, it's how smartphone applications are structured in Android Studio.</p>
  
  
  <ul class="tags">
    <li class="tag-haskell">#<a href="../../tags/haskell.html">haskell</a></li><li class="tag-beginner">#<a href="../../tags/beginner.html">beginner</a></li>
  </ul>
  
</header>


<p class="alert info">These are lecture notes from my guest lecture at Universität Koblenz. Because the example was presented live in a demo, it appears a bit out of the blue in the standalone write-up. However, the source code with the complete example is available here.</p>

<article>
  <div class="toc"><div class="header">Contents</div>
<ul>
<li><a href="#mvc" id="toc-mvc"><span class="toc-section-number">1</span> MVC</a></li>
<li><a href="#functional-mvc-gloss" id="toc-functional-mvc-gloss"><span class="toc-section-number">2</span> Functional MVC: Gloss</a>
<ul>
<li><a href="#picture" id="toc-picture"><span class="toc-section-number">2.1</span> Picture</a></li>
<li><a href="#event" id="toc-event"><span class="toc-section-number">2.2</span> Event</a></li>
<li><a href="#gloss" id="toc-gloss"><span class="toc-section-number">2.3</span> Gloss</a></li>
</ul></li>
</ul>
</div>
<h1 data-number="1" id="mvc"><span class="header-section-number">1</span> MVC</h1>
<p>Model–view–controller (MVC) is a software architectural pattern commonly used
for developing user interfaces that divide the related program logic into three
interconnected elements.</p>
<p><strong>MVC</strong> says that an interactive application should consist roughly of three
main parts – <strong>Model</strong>, <strong>View</strong>, and <strong>Controller</strong>.</p>
<ul>
<li><p>The <strong>Model</strong> is the data and state that we need to keep track of to
<em>model</em> our application. If you’re programming a Chess game, the model could
consist of the state of the board (which pieces are where), the time passed
since the last player played, whose turn it is, etc…</p></li>
<li><p>The <strong>View</strong> is the definition of how our model should be displayed to the
user. Intuitively, you can think of it as a function <code>Model -&gt; UI</code> (and
begin to see how <em>functional MVC</em> might be interesting). For the above
example, the view would define how the chess board can be shown to the user
(a 3d object, a 2d ascii board, …), where the time passed shows up in the
screen, etc.</p></li>
<li><p>The <strong>Controller</strong> handles all events and interactions with the application
and how they modify the existing model. In chess, the controller could
define that when a player drags a piece in the board, the position of that
piece in the board <em>model</em> changes to the new position, the current turn
changes to the other player, and the time passed is reset to zero.</p></li>
</ul>
<p>And the three relate in the following manner:</p>
<figure>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a0/MVC-Process.svg/400px-MVC-Process.svg.png" alt="MVC diagram from Wikipedia" />
<figcaption aria-hidden="true">MVC diagram from Wikipedia</figcaption>
</figure>
<h1 data-number="2" id="functional-mvc-gloss"><span class="header-section-number">2</span> Functional MVC: Gloss</h1>
<p>How does the model-view-controller idea translate into functional programming?
It turns out to be quite simple because the three parts match basic FP concepts.</p>
<p>We’ll focus on the library <strong>Gloss</strong> to develop a graphical application. Gloss
is very easy to setup, provides abstractions for drawing graphics, and
outlines the MVC compoonents clearly. We’ll implement a simple simulation of the
101companies employees to illustrate the concepts.</p>
<p>To define the model, the structure which is updated thorought the program, we
simply define a new datatype that <em>models</em> the application to be updated and
displayed. Our model will be just company itself! Nothing of Gloss comes in here.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- | Our model</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Company</span> <span class="ot">=</span> <span class="dt">Company</span> <span class="dt">Name</span> [<span class="dt">Employee</span>]</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Employee</span> <span class="ot">=</span> <span class="dt">Employee</span> <span class="dt">Name</span> <span class="dt">Address</span> <span class="dt">Salary</span></span></code></pre></div>
<p>The view, as mentioned before, is just a function from the model to the
graphics to be drawn. With Gloss, the graphics to be displayed are defined with
the <code>Picture</code> type. That means this is the function signature</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ot">view ::</span> <span class="dt">Company</span> <span class="ot">-&gt;</span> <span class="dt">Picture</span></span></code></pre></div>
<p>Ahead, we’ll see how to display things on the screen with Gloss and further
inspect the <code>Picture</code> type.</p>
<p>The model, <em>in gloss</em>, actually consists of two separate functions. The first
updates the model when events (of type <code>Event</code>) happen, and the second updates
the model when time passes. We could name these two functions <code>handleEvent</code> and
<code>frameUpdate</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ot">handleEvent ::</span> <span class="dt">Event</span> <span class="ot">-&gt;</span> <span class="dt">Company</span> <span class="ot">-&gt;</span> <span class="dt">Company</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ot">frameUpdate ::</span> <span class="dt">Float</span> <span class="ot">-&gt;</span> <span class="dt">Company</span> <span class="ot">-&gt;</span> <span class="dt">Company</span></span></code></pre></div>
<p>the <code>Float</code> in <code>frameUpdate</code> is the time passed since the last frame. We’ll look
at frames and events ahead.</p>
<p>Finally, to put this all together, gloss provides a function that takes an
initial model, the view function, the controller functions, and runs the
described application.</p>
<p>Which means that if with a datatype and those three functions defined, we’re
ready to run our graphical application.</p>
<p>The function is:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- | Play a game in a window.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ot">play    ::</span> <span class="dt">Display</span>                      <span class="co">-- ^ Display mode.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="ot">-&gt;</span> <span class="dt">Color</span>                        <span class="co">-- ^ Background color.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="ot">-&gt;</span> <span class="dt">Int</span>                          <span class="co">-- ^ Number of simulation steps to take for each second of real time.</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="ot">-&gt;</span> world                        <span class="co">-- ^ The initial world.</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="ot">-&gt;</span> (world <span class="ot">-&gt;</span> <span class="dt">Picture</span>)           <span class="co">-- ^ A function to convert the world a picture.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="ot">-&gt;</span> (<span class="dt">Event</span> <span class="ot">-&gt;</span> world <span class="ot">-&gt;</span> world)    <span class="co">-- ^ A function to handle input events.</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="ot">-&gt;</span> (<span class="dt">Float</span> <span class="ot">-&gt;</span> world <span class="ot">-&gt;</span> world)    <span class="co">-- ^ A function to step the world one iteration.</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                                        <span class="co">--   It is passed the period of time (in seconds) needing to be advanced.</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="ot">-&gt;</span> <span class="dt">IO</span> ()</span></code></pre></div>
<p>There’s quite a bit more happening here so let’s go over each parameter:</p>
<ul>
<li><p><code>Display</code> is the window the game will run in. This can be either <code>FullScreen</code>
or <code>InWindow "Nice Window" (width, height) (10, 10)</code> in which the parameters
are the window title, the width and height of the window, and its starting
position.</p></li>
<li><p>The <code>Color</code> is for the background color of the window. The simplest colors are
<code>black</code> and <code>white</code>, and there are other functions to create colors</p></li>
<li><p>The <code>Int</code> is the number of frames in a second. Every new frame, the
<code>frameUpdate</code> function we defined previously is called (and the float passed
to it is how much time each frame lasts). For example, <code>60</code> would mean 60
frames per second, and each time the function would be passed <code>1/60 = 0.016</code>
seconds as an argument.</p></li>
<li><p>The <code>world</code> type variable stands for our model. This parameter is the initial
state of our model. We’d use some <code>initialCompany :: Company</code> here.</p></li>
<li><p>The <code>world -&gt; Picture</code> function is our view function. We’d pass <code>view ::     Company -&gt; Picture</code> here.</p></li>
<li><p>The <code>Event -&gt; world -&gt; world</code> function is half of our controller. Given an event,
we update the model. We’d pass <code>handleEvent :: Event -&gt; Company -&gt; Company</code>.</p></li>
<li><p>The <code>(Float -&gt; world -&gt; world)</code> function is the other half of the controller.
It is called every step/frame of our application (the frame rate is defined
in the <code>Int</code> parameter above). We’d pass <code>frameUpdate :: Float -&gt; Company -&gt;     Company</code> here.</p></li>
</ul>
<p>And the return type is <code>IO ()</code>! Meaning we can call this directly from main. The
main program would look like:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    play</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">FullScreen</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        black          <span class="co">-- Background color</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="dv">30</span>             <span class="co">-- Number of frames for each second of real time.</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        initialCompany <span class="co">-- The company at the beginning of the game</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        view           <span class="co">-- How to display a company?</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        handleEvent    <span class="co">-- How to react to events?</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        frameUpdate    <span class="co">-- What to do every frame?</span></span></code></pre></div>
<h2 data-number="2.1" id="picture"><span class="header-section-number">2.1</span> Picture</h2>
<p>In this section we explain how to create <code>Picture</code>s, and how the 101company’s
<em>view</em> is implemented.</p>
<p>In Gloss, <code>Picture</code>s are the building blocks out of which we build a graphical
application. There exist multiple ways of creating pictures; the simplest ones
are to directly use the data constructors for <code>Picture</code>.</p>
<p>For example, these would be valid pictures.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Draws a circle with radius 5</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Circle</span> <span class="dv">5</span><span class="ot">    ::</span> <span class="dt">Picture</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Draws some text rotated by 90º degrees</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="dt">Rotate</span> <span class="dv">90</span> (<span class="dt">Text</span> <span class="st">&quot;Hello&quot;</span>)<span class="ot">    ::</span> <span class="dt">Picture</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Draws both simultaneously on the screen</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="dt">Pictures</span> [<span class="dt">Circle</span> <span class="dv">5</span>, <span class="dt">Rotate</span> <span class="dv">90</span> (<span class="dt">Text</span> <span class="st">&quot;Hello&quot;</span>)]<span class="ot">   ::</span> <span class="dt">Picture</span></span></code></pre></div>
<p>As we see, we can combine pictures using the <code>Pictures</code> data constructor,
<code>Rotate</code>, <code>Translate</code>, and <code>Scale</code> them (with those data constructors), and
create them from scratch as with <code>Circle</code>, <code>Polygon</code>, etc.</p>
<p>This is more evident from the definition of <code>Picture</code>. Here is a bit from the
<a href="https://hackage.haskell.org/package/gloss-1.13.2.2/docs/Graphics-Gloss-Data-Picture.html#t:Picture">pictures
documentation</a></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Picture</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- | A blank picture, with nothing in it.</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        <span class="ot">=</span> <span class="dt">Blank</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- | A convex polygon filled with a solid color.</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">Polygon</span>       <span class="dt">Path</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- | A circle with the given radius.</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">Circle</span>        <span class="dt">Float</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- | A circle with the given radius and thickness.</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">--   If the thickness is 0 then this is equivalent to `Circle`.</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">ThickCircle</span>   <span class="dt">Float</span> <span class="dt">Float</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- | Some text to draw with a vector font.</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">Text</span>          <span class="dt">String</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- | A picture translated by the given x and y coordinates.</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">Translate</span>     <span class="dt">Float</span> <span class="dt">Float</span>     <span class="dt">Picture</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- | A picture rotated clockwise by the given angle (in degrees).</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">Rotate</span>        <span class="dt">Float</span>           <span class="dt">Picture</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- | A picture scaled by the given x and y factors.</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">Scale</span>         <span class="dt">Float</span>   <span class="dt">Float</span>   <span class="dt">Picture</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- | A picture consisting of several others.</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">Pictures</span>      [<span class="dt">Picture</span>]</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="op">...</span> <span class="co">-- ommited for brevity</span></span></code></pre></div>
<p>Now that we’ve seen the concept of pictures, and know that they will be displayed
by the main function, we must still consider how they’re laid out on the window.</p>
<ul>
<li>The window has a width and a height, say 400x400</li>
<li>Each picture has a pair of coordinates, for it’s position on the x and y axis.
By default this position is (0,0).</li>
<li>The origin (coordinates <code>(0, 0)</code>) is located in the middle of the window.
Taking the window of 400x400, the center of the left border would be at
(-200, 0), the right border would be at (200, 0), the center of the top
border would be at (0, 200) and the bottom border at (0, -200)</li>
</ul>
<p>Now we can get to creating the view for our company! We’ll display our company
employees on the screen, one circle for each. The bigger the circle, the bigger
the pay.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Company</span> <span class="ot">=</span> <span class="dt">Company</span> <span class="dt">Name</span> <span class="dt">Employees</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Employee</span> <span class="ot">=</span> <span class="dt">Employee</span> <span class="dt">Name</span> <span class="dt">Address</span> <span class="dt">Salary</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="ot">view ::</span> <span class="dt">Company</span> <span class="ot">-&gt;</span> <span class="dt">Picture</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>view (<span class="dt">Company</span> _ employees) <span class="ot">=</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- We map each employee to its picture</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> emPics <span class="ot">=</span> <span class="fu">map</span> empToPicture employees</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- And make one big picture out of all of them</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>     <span class="kw">in</span> <span class="dt">Pictures</span> emPics</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="ot">empToPicture ::</span> <span class="dt">Employee</span> <span class="ot">-&gt;</span> <span class="dt">Picture</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>empToPicture (<span class="dt">Employee</span> name _ salary) <span class="ot">=</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- We'll combine both the text and the circle into one picture</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Pictures</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        [ <span class="dt">Text</span> name <span class="co">-- Draw the employee's name</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        , <span class="dt">Circle</span> (salary<span class="op">*</span><span class="fl">0.02</span>) <span class="co">-- Draw a circle with radius proportional to salary</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        ]</span></code></pre></div>
<p>An attentive reader might comment that all employees will be displayed on top of
each other. They’re right since all pictures are by default positioned at (0,0)</p>
<p>In the demo, I drew each employee evenly spaced from the others around an
non-visible circle. The idea is to divide 360º by the number of employees and
then calculate their position using sin and cosine. There’s no need to go over
all the details, so here’s a plausible implementation of that should explain
itself.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ot">view ::</span> <span class="dt">Company</span> <span class="ot">-&gt;</span> <span class="dt">Picture</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>view (<span class="dt">Company</span> _ employees) <span class="ot">=</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- We map each employee (with its number) to its picture</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> emPics <span class="ot">=</span> <span class="fu">map</span> empToPicture (<span class="fu">zip</span> [<span class="dv">0</span><span class="op">..</span>] employees)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- And make one big picture out of all of them</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">in</span> <span class="dt">Pictures</span> emPics</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="ot">    nEmployees ::</span> <span class="dt">Float</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    nEmployees <span class="ot">=</span> <span class="fu">fromIntegral</span> (<span class="fu">length</span> employees)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="ot">    empToPicture ::</span> (<span class="dt">Float</span>, <span class="dt">Employee</span>) <span class="ot">-&gt;</span> <span class="dt">Picture</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    empToPicture (i, <span class="dt">Employee</span> name _ salary) <span class="ot">=</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- Move the picture according to calculation</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">Translate</span> (<span class="dv">150</span><span class="op">*</span><span class="fu">cos</span> (<span class="dv">2</span><span class="op">*</span><span class="fu">pi</span><span class="op">*</span>i<span class="op">/</span>nEmployees)) (<span class="dv">150</span><span class="op">*</span><span class="fu">sin</span> (<span class="dv">2</span><span class="op">*</span><span class="fu">pi</span><span class="op">*</span>i<span class="op">/</span>nEmployees)) <span class="op">$</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>            <span class="co">-- We'll combine both the text and the circle into one picture</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>            <span class="dt">Pictures</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>                [ <span class="dt">Text</span> name <span class="co">-- Draw the employee's name</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                , <span class="dt">Circle</span> (salary<span class="op">*</span><span class="fl">0.02</span>) <span class="co">-- Draw a circle with radius proportional to salary</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                ]</span></code></pre></div>
<p>This will layout our employees around the center, evenly spaced.</p>
<p>To finalize, we’ll add some color to the circles. We want employees which are
paid a lot of money to be represented with red circles, the ones which are paid
little money to be yellow, and the others to be orange.</p>
<p>Where we currently define the circle, we’ll rather define a colored circle</p>
<pre><code>-- Before
Circle (salary*0.02)

-- After
Color (mkColor salary) (Circle (salary*0.02))
  where
    mkColor s
      | s &gt; 10000 = red
      | s &gt; 1000 = orange
      | otherwise = yellow</code></pre>
<p>To display just the view without defining the controller we can use the
<code>display</code> function. This one is a bit simpler than <code>play</code> because it only cares
about the view.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>main</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> display</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        (<span class="dt">InWindow</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;Hello World&quot;</span>     <span class="co">-- window title</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                (<span class="dv">400</span>, <span class="dv">150</span>)       <span class="co">-- window size</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                (<span class="dv">10</span>, <span class="dv">10</span>))        <span class="co">-- window position</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        white                    <span class="co">-- background color</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        (view initialCompany)    <span class="co">-- picture to display</span></span></code></pre></div>
<p>For the final demo code see the <code>Display</code> module.</p>
<h2 data-number="2.2" id="event"><span class="header-section-number">2.2</span> Event</h2>
<p>In this section we explain Gloss’s <code>Event</code>s, and how the 101company’s
<em>controller</em> is implemented.</p>
<p>In Gloss, the <code>Event</code> type models the possible input events in the application,
such as mouse clicks, key presses, window resizes, ….</p>
<p>Everytime such an event occurs, the controller function with type <code>Event -&gt; world -&gt; world</code> is called and the input event passed as the first argument.</p>
<p>Events are defined by its data constructors:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Event</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="ot">=</span> <span class="dt">EventKey</span>    <span class="dt">Key</span> <span class="dt">KeyState</span> <span class="dt">Modifiers</span> (<span class="dt">Float</span>, <span class="dt">Float</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> <span class="dt">EventMotion</span> (<span class="dt">Float</span>, <span class="dt">Float</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> <span class="dt">EventResize</span> (<span class="dt">Int</span>, <span class="dt">Int</span>)</span></code></pre></div>
<p><code>EventKey</code> is the data constructor for event involving a <code>Key</code>, which could be a
mouse click or a key press, since <code>Key</code> is defined as</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Key</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>        <span class="ot">=</span> <span class="dt">Char</span>        <span class="dt">Char</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">SpecialKey</span>  <span class="dt">SpecialKey</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">MouseButton</span> <span class="dt">MouseButton</span></span></code></pre></div>
<p>A <code>Key</code> might be a simple character key, a special key, or a mouse button. For
more information on the latter two types you might check the
<a href="https://hackage.haskell.org/package/gloss-1.13.2.2/docs/Graphics-Gloss-Interface-IO-Interact.html#t:Event">documentation</a></p>
<p>A <code>KeyState</code> indicates whether the key is pressed down, or released. We’ll use
<code>Up</code>, since in our simulation we only care about when the user “finishes”
pressing a key, not while they’re pressing it</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">KeyState</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>        <span class="ot">=</span> <span class="dt">Down</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">Up</span></span></code></pre></div>
<p>Our controller function will have to pattern match on <code>Event</code> to decide how the
model should be updated.</p>
<p>We want to react to three different events: When <code>C</code> is pressed we cut the
salaries of the employees in half; when <code>A</code> is pressed we add an employee; when
<code>D</code> is pressed we delete an employee.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ot">eventHandler ::</span> <span class="dt">Event</span> <span class="ot">-&gt;</span> <span class="dt">Company</span> <span class="ot">-&gt;</span> <span class="dt">Company</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>eventHandler evt c <span class="ot">=</span> <span class="kw">case</span> evt <span class="kw">of</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- 'c' key was pressed, cut</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">EventKey</span> (<span class="dt">Key</span> <span class="ch">'c'</span>) <span class="dt">Up</span> _ _ <span class="ot">-&gt;</span> cut c</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- 'd' key was pressed, delete</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">EventKey</span> (<span class="dt">Key</span> <span class="ch">'d'</span>) <span class="dt">Up</span> _ _ <span class="ot">-&gt;</span> deleteEmp c</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- 'a' key was pressed, add</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">EventKey</span> (<span class="dt">Key</span> <span class="ch">'a'</span>) <span class="dt">Up</span> _ _ <span class="ot">-&gt;</span> addEmp c</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- For all other cases we return the company unchanged</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    _ <span class="ot">-&gt;</span> c</span></code></pre></div>
<p>The <code>cut</code>, <code>deleteEmp</code> and <code>addEmp</code> are simple functions of type <code>Company -&gt; Company</code></p>
<p>As for the other part of the controller: We want the salary of all
employees to be raised every frame.</p>
<p>We can write our <code>Float -&gt; Company -&gt; Company</code> to raise the employees salaries
by 10€ everytime it’s called – as long as the employee earns less than 10000€.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ot">frameUpdate ::</span> <span class="dt">Float</span> <span class="ot">-&gt;</span> <span class="dt">Company</span> <span class="ot">-&gt;</span> <span class="dt">Company</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>frameUpdate _ (<span class="dt">Company</span> n emps) <span class="ot">=</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Company</span> n <span class="op">$</span> <span class="fu">map</span> (raise (<span class="op">&lt;</span> <span class="dv">10000</span>) <span class="dv">10</span>) emps</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    raise ::</span> (<span class="dt">Salary</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>) <span class="ot">-&gt;</span> <span class="dt">Salary</span> <span class="ot">-&gt;</span> <span class="dt">Employee</span> <span class="ot">-&gt;</span> <span class="dt">Employee</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    raise p inc (<span class="dt">Employee</span> n a s) <span class="ot">=</span> <span class="dt">Employee</span> n a ((<span class="kw">if</span> p s <span class="kw">then</span> inc <span class="kw">else</span> <span class="dv">0</span>) <span class="op">+</span> s)</span></code></pre></div>
<p>The demo code can be read in the <code>Main</code> module.</p>
<h2 data-number="2.3" id="gloss"><span class="header-section-number">2.3</span> Gloss</h2>
<p>Gloss is a framework for programming graphical applications in Haskell, which
is itself described in terms of the <strong>MVC</strong> pattern.</p>
<p>In Haskell (and other strongly-typed functional programming languages) in
particular, the <strong>MVC</strong> pattern is less loosely defined than usual, and can be
more clearly identified in the code. This is because the we can “strongly”
encode our <em>model</em> with types and the <em>view</em> and <em>controller</em> are simply
functions defined in terms of the model type. Pure functions and user-defined
types get us a clearer distinction between the three.</p>
<p>Hello World:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>main</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> display</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        (<span class="dt">InWindow</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;Hello World&quot;</span>     <span class="co">-- window title</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                (<span class="dv">400</span>, <span class="dv">150</span>)       <span class="co">-- window size</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                (<span class="dv">10</span>, <span class="dv">10</span>))        <span class="co">-- window position</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        white                    <span class="co">-- background color</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        picture                  <span class="co">-- picture to display</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="ot">picture ::</span> <span class="dt">Picture</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>picture <span class="ot">=</span> <span class="dt">Translate</span> (<span class="op">-</span><span class="dv">170</span>) (<span class="op">-</span><span class="dv">20</span>) <span class="co">-- shift the text to the middle of the window</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">$</span> <span class="dt">Scale</span> <span class="fl">0.5</span> <span class="fl">0.5</span>          <span class="co">-- display it half the original size</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">$</span> <span class="dt">Text</span> <span class="st">&quot;Hello World&quot;</span>     <span class="co">-- text to display</span></span></code></pre></div>
<!-- --- -->
<!-- Draft part below -->
<!-- ================ -->
<!-- TODO: Não esquecer de mostrar outros exemplos de coisas feitas em gloss, se -->
<!-- calhar até no início -->
<!-- After seeing how we can display some simple text on the screen, let's work on -->
<!-- building a representation of our company. To avoid taking care of positioning -->
<!-- we'll simply display the employees along a circle, making a bigger circle for a -->
<!-- better paid employee. -->
<!-- And now we can add names to them. Let's display them at the top left corner of the circle -->
<!-- To extend our simulation we'll say that the company raises the salary of -->
<!-- everyone that isn't making > $10000 by $250 everyday. It is up to the manager to -->
<!-- keep on cutting the salaries before they run out of money. -->
<!-- Controller -->
<!-- ========== -->
<!-- When writing a controller, that is, a function that updates the state of the -->
<!-- world, we want to react to both user events, such as mouse clicks, but also to -->
<!-- the passing of time. -->
<!-- Considering this, the controller in gloss is defined with two separate -->
<!-- functions: one to control the time moving forward, and the other to react to -->
<!-- user events. -->
<!-- These two functions are passed to the main `play` function i.e. `play` takes two -->
<!-- higher order functions that control events and time -->

</article>

    </main>
    <footer>
        <small>
            Rodrigo Mesquita &copy; 2022-2023
        </small>
    </footer>
  </body>
</html>
